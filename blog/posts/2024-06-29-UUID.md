---
layout: Post
title: 数据库主键选择
subtitle: 为什么我会推荐使用UUID作为数据库主键
author: emo
date: 2024-06-29
useHeaderImage: true
headerImage: /img/in-post/MySQL.jpeg
headerMask: rgba(40, 57, 101, .4)
giscus: false
catalog: true
hide: false
tags:
  - MySQL
---

UUID作为主键的优劣势

<!-- more -->

## 优势

### 全局唯一性

使用自增序列作为主键可以确保每个记录有一个唯一的递增标识符，但这种唯一性仅限于单个表内。相比之下，UUID是全局唯一的，即使在不同的数据库或表中也不会重复。这意味着您可以更轻松地在不同系统或数据库之间复制数据，而无需担心主键冲突。

### 分布式系统的支持

在分布式系统中，使用自增序列可能会面临一些挑战。由于每个节点都需要维护一个独立的自增计数器，因此可能会出现冲突或同步问题。相比之下，UUID可以在分布式环境中轻松使用，因为生成UUID的算法保证了其全局唯一性，而不需要中心化的计数器。

### 隐私和安全性

使用自增序列作为主键可能会暴露系统中数据的规律性，例如您可以根据主键推断出数据的创建顺序或数据量。这可能会对隐私和安全性造成潜在风险。相比之下，UUID是随机生成的，不会泄露任何关于数据的敏感信息。

### 缓存友好性
自增主键可能导致数据库写入瓶颈，特别是在高并发的情况下，因为所有写入都需要更新同一个计数器。相比之下，UUID可以在不同节点上生成，减少了写入时的竞争，更有利于分布式系统的性能优化。

## 劣势

* 存储空间：UUID 是一个较长的字符串（通常为 36 个字符），相比较自增的整数 ID，会占用更多的存储空间。这意味着在存储大量数据时，使用 UUID 作为主键可能会增加存储成本。

* 索引性能：在数据库中，主键通常会被用作索引的键。由于 UUID 是随机生成的字符串，插入新记录时，数据在磁盘上的存储位置可能会更分散，这可能导致索引的性能下降。相比之下，自增的整数 ID 是顺序生成的，可以更好地利用磁盘的顺序读取性能。

* 插入性能：由于 UUID 是随机生成的，插入新记录时可能需要更多的磁盘操作，因为数据的存储位置可能会更加分散，这可能会影响插入性能。

* 缓存效率：如果数据库使用缓存来加速查询，UUID 可能会降低缓存的效率。因为 UUID 是随机生成的，不容易预测下一个值是什么，这可能导致缓存失效的频率增加。

* 可读性：相对于自增的整数 ID，UUID 是随机生成的字符串，不如整数 ID 直观。

## 结论
尽管使用UUID作为数据库主键可能会导致一些性能上的损失（例如索引性能和存储空间），但它提供了更广泛的适用性和更好的数据隐私、安全性和分布式系统支持。在实际应用中，需要根据具体情况权衡利弊。如果全局唯一性和分布式系统支持对您的应用至关重要，那么使用 UUID 作为主键可能是更好的选择。如果对性能要求非常高，可能需要进行更深入的评估和优化。
